// Minimal JS: products, modal, and a Three.js neon background
const PRODUCTS = [
  { id: "swavey-injector", title: "Swavey Injector", price: 10, desc: "Fast, secure script loader. Ready-to-use." },
  { id: "neon-ui-kit", title: "Neon UI Kit", price: 8, desc: "UI components & CSS neon styles for your projects." },
  { id: "mod-toolkit", title: "Moderator Toolkit", price: 15, desc: "Automated moderation commands for Discord bots." }
];

document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('year').textContent = new Date().getFullYear();
  buildProductGrid();
  setupModal();
  wireDiscordButtons();
  initThreeBG();
});

// build product cards
function buildProductGrid(){
  const grid = document.getElementById('productGrid');
  PRODUCTS.forEach(p=>{
    const el = document.createElement('div');
    el.className = 'product';
    el.innerHTML = `
      <div class="title">${p.title}</div>
      <div class="desc" style="margin-top:6px;color:rgba(255,255,255,0.75)">${p.desc}</div>
      <div class="price">$${p.price}</div>
      <div style="margin-top:10px">
        <button class="btn btn-primary btn-buy" data-id="${p.id}">Buy</button>
        <button class="btn btn-ghost btn-contact" data-id="${p.id}">Contact</button>
      </div>
    `;
    grid.appendChild(el);
  });

  document.body.addEventListener('click',(e)=>{
    const buy = e.target.closest('.btn-buy');
    const contact = e.target.closest('.btn-contact');
    if(buy) openBuyModal(buy.dataset.id);
    if(contact) openContactModal(contact.dataset.id);
  });
}

// modal logic
const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');
const modalClose = document.getElementById('modalClose');

function setupModal(){
  modalClose.addEventListener('click', closeModal);
  modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });
}

function openBuyModal(id){
  const p = PRODUCTS.find(x=>x.id===id);
  modalContent.innerHTML = `
    <h3 style="font-family: 'Orbitron', sans-serif">${p.title}</h3>
    <p>${p.desc}</p>
    <p style="font-weight:800;color:#ff2b6d">Price: $${p.price}</p>
    <div style="margin-top:14px;display:flex;gap:10px">
      <a id="purchaseLink" class="btn btn-primary" href="#" target="_blank">Purchase (placeholder)</a>
      <button class="btn btn-ghost" id="contactSeller">Contact on Discord</button>
    </div>
    <p style="margin-top:12px;color:rgba(255,255,255,0.7);font-size:13px">Payment & delivery links go here. Replace purchase link with your payment provider (Gumroad, Stripe, etc.)</p>
  `;
  // placeholder links - replace with real payment link
  document.getElementById('purchaseLink').href = "https://example.com/purchase/" + id;
  document.getElementById('contactSeller').addEventListener('click', ()=> {
    window.open(getDiscordInvite(), '_blank');
  });
  openModal();
}

function openContactModal(id){
  const p = PRODUCTS.find(x=>x.id===id);
  modalContent.innerHTML = `
    <h3>Contact about: ${p.title}</h3>
    <p>Click to open Discord or copy invite:</p>
    <div style="display:flex;gap:10px;margin-top:12px">
      <button class="btn btn-primary" id="openDiscord">Open Discord</button>
      <button class="btn btn-ghost" id="copyInvite">Copy Invite</button>
    </div>
  `;
  document.getElementById('openDiscord').addEventListener('click', ()=> window.open(getDiscordInvite(), '_blank'));
  document.getElementById('copyInvite').addEventListener('click', ()=> {
    navigator.clipboard?.writeText(getDiscordInvite()).then(()=> alert('Discord invite copied'));
  });
  openModal();
}

function openModal(){ modal.classList.remove('hidden'); modal.setAttribute('aria-hidden','false'); }
function closeModal(){ modal.classList.add('hidden'); modal.setAttribute('aria-hidden','true'); }

// Discord buttons wiring
function wireDiscordButtons(){
  const inviteEls = [document.getElementById('discordInvite'), document.getElementById('discordJoin'), document.getElementById('joinDiscordBtn')];
  inviteEls.forEach(el=> { if(el) el.href = getDiscordInvite(); });
}

// Return your discord invite â€” replace with real invite
function getDiscordInvite(){
  return "https://discord.gg/YOUR_DISCORD_INVITE"; // <-- Replace this with your invite
}

/* ----------------------------
  Three.js neon animated background
   - lightweight animated grid/wave
   - falls back gracefully if WebGL unavailable
------------------------------*/
function initThreeBG(){
  const container = document.getElementById('bg-scene');
  if(!container) return;

  // basic scene
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0, 10, 40);

  const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  container.appendChild(renderer.domElement);

  // neon grid lines
  const grid = new THREE.Group();
  const mat = new THREE.LineBasicMaterial({ color: 0xff0a5a, transparent:true, opacity:0.08 });
  const size = 120;
  const step = 4;
  for(let i=-size;i<=size;i+=step){
    const geom1 = new THREE.BufferGeometry().setFromPoints([ new THREE.Vector3(i, -6, -size), new THREE.Vector3(i, -6, size) ]);
    const geom2 = new THREE.BufferGeometry().setFromPoints([ new THREE.Vector3(-size, -6, i), new THREE.Vector3(size, -6, i) ]);
    const l1 = new THREE.Line(geom1, mat.clone());
    const l2 = new THREE.Line(geom2, mat.clone());
    l1.material.opacity = 0.05 + Math.random()*0.12;
    l2.material.opacity = 0.05 + Math.random()*0.12;
    grid.add(l1,l2);
  }
  scene.add(grid);

  // floating neon points
  const pointsGeom = new THREE.BufferGeometry();
  const count = 300;
  const positions = new Float32Array(count * 3);
  for(let i=0;i<count;i++){
    positions[i*3] = (Math.random()-0.5)*120;
    positions[i*3+1] = (Math.random()*18)-10;
    positions[i*3+2] = (Math.random()-0.5)*120;
  }
  pointsGeom.setAttribute('position', new THREE.BufferAttribute(positions, 3));
  const pointsMat = new THREE.PointsMaterial({ color: 0xff2b6d, size: 0.9, transparent:true, opacity:0.45 });
  const points = new THREE.Points(pointsGeom, pointsMat);
  scene.add(points);

  // subtle camera movement on mouse
  const mouse = {x:0,y:0};
  window.addEventListener('mousemove', (e)=> {
    mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
    mouse.y = (e.clientY / window.innerHeight) * 2 - 1;
  });

  function animate(){
    requestAnimationFrame(animate);
    const t = performance.now() * 0.0005;
    grid.rotation.y = t * 0.15;
    points.rotation.y = -t * 0.1;
    camera.position.x += (mouse.x * 8 - camera.position.x) * 0.04;
    camera.position.y += (-mouse.y * 6 - camera.position.y) * 0.03;
    camera.lookAt(0,0,0);
    renderer.render(scene, camera);
  }
  animate();

  window.addEventListener('resize', ()=> {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
  }
